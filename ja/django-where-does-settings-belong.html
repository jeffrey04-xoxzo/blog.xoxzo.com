<!DOCTYPE html>
<html lang="ja">
<head>
          <title>Xoxzoの公式ブログ：「開花、発展、向上させる」</title>
        <meta charset="utf-8" />
        <link href="http://devblog.xoxzo.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Xoxzoの公式ブログ：「開花、発展、向上させる」 Full Atom Feed" />
        <link href="http://devblog.xoxzo.com/feeds/engineering.atom.xml" type="application/atom+xml" rel="alternate" title="Xoxzoの公式ブログ：「開花、発展、向上させる」 Categories Atom Feed" />



    <meta name="tags" content="django" />
    <meta name="tags" content="Python" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">Xoxzoの公式ブログ：「開花、発展、向上させる」 <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./django-where-does-settings-belong.html" rel="bookmark"
         title="Permalink to Django: Where does settings belong ?">Django: Where does settings belong ?</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2012-05-23T20:07:00+09:00">
      2012-05-23
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/kamal-mustafa.html">Kamal Mustafa</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Settings is very central to all Django applications. Django even barf if
you<br />
don't supply one and import any django modules or functions (most of
it). The<br />
way to specify settings to Django app however a bit awkward. Rather
calling<br />
some function and pass the settings to that function, Django require you
to put<br />
the path to settings module in os.environ dict. Consider a Flask
application:-</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
<span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>It feels natural. You instantiate an app, call it's run() method and
pass<br />
<code>debug</code> as parameter to the function. It's easy to explain. Or if Flask
not<br />
your favourite, let's take a look at Bottle example:-</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
<span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
<span class="k">return</span> <span class="s2">&quot;Hello World!&quot;</span>
<span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>It still maintain the same flow. But let's look at how we pass settings
to<br />
Django app. This is what you get in default <code>manage.py</code> generated by<br />
<code>django-admin.py startproject</code> command:-</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="p">,</span> <span class="s1">&#39;myapp.settings&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>
<span class="n">execute_from_command_line</span><span class="p">()</span>
</pre></div>


<p>Compared to example for other 2 frameworks, the logic now seem to branch
into 2<br />
separate paths. First you have to figure out what is going on with<br />
<code>os.environ.setdefault()</code> stuff, and then the stuff with<br />
<code>execute_from_command_line()</code>. Enough to confuse beginner. Only later on
I<br />
figured out that you can actually skip <code>os.environ</code> stuff and directly
set<br />
settings as you wish. The above example can be re-written as:-</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="n">settings</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">DEBUG</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_from_command_line</span>
<span class="n">execute_from_command_line</span><span class="p">()</span>
</pre></div>


<p>Now it look more like the other 2 frameworks. This however not much an
issue,<br />
because once your application grow, you'll definitely want to put your
settings<br />
in one central place and could be the reason why Django has made that
decision<br />
for you early on. The real issue is where should we put the central
settings ?</p>
<p>Django settings, being a pure python module mean it has to be somewhere
on your<br />
<code>sys.path</code> so Django can import it to initialize the application.
Logically I<br />
want the settings for <code>myapp</code> to appear as <code>myapp.settings</code>. This
however would<br />
make the settings now part of the application. But settings suppose to
have<br />
some piece of information that will be used to create and initialized
the<br />
application (ROOT_URLCONF come to mind) but now the settings itself
already<br />
part of the application. I've repeated the word application too much in
last<br />
sentence.</p>
<p>One situation when this chicken-and-egg manifest. I want to deploy my
app using<br />
<code>setup.py</code> which mean <code>myapp</code> will be installed in <code>site-packages</code>. That
also<br />
mean <code>settings.py</code> will also reside in <code>site-packages</code>. But for web
application<br />
there are more than just python code. There should be a directory to
store<br />
uploaded files or csv files for some external data. I want to keep all
this in<br />
a self contained project directory but since now <code>myapp.settings</code> reside
in<br />
<code>site-packages</code> I'm losing the ability to calculate the path to my
project dir<br />
at run time. While I can compensate this by having a standardized
location on<br />
production machine, I'd still want to keep this in one single project
dir for<br />
development so each developers work doesn't step into each other and
also for<br />
portabilty of development environment.</p>
<p>The only way now is to not installing <code>myapp</code> into <code>site-packages</code> but
altering<br />
sys.path to add path to the directory containing <code>myapp</code> package. Some
of open<br />
source django project I found put <code>settings.py</code> outside the app
packages,<br />
usually at the same level of <code>manage.py</code> or <code>.wsgi</code> script used to
launch the<br />
app. They then specify the settings as
<code>os.environ['DJANGO_SETTINGS_MODULE'] = 'settings'</code>. This make settings
external to the application but at the same time<br />
exposed <code>settings</code> into the global namespace. While I haven't yet found
any<br />
packages at PyPI using the name <code>settings</code>, it still doesn't feel right.</p>
<p>I take a look at how settings are handled in Pylons/Pyramid project. Few
things<br />
observed:-</p>
<ul>
<li>They use INI files instead of pure python.</li>
<li>The INI files are placed at the top level of project directory.</li>
<li>Application get installed into <code>site-packages</code> using setup.py</li>
<li>Since settings stayed in project dir, you still get referenced to
    the project<br />
   dir even your app get installed into <code>site-packages</code>.</li>
</ul>
<p>While it look quite similar to placing <code>settings.py</code> at your project
root, the<br />
INI files is not python module so there's no problem of exposing the
settings<br />
into global namespace. The settings now also look truely external to
the<br />
application. This has getting quite long but still the question
remained<br />
unanswered, where should we put the settings file ?</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>