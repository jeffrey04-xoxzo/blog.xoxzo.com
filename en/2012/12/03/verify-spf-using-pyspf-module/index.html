<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="t4rlWAOKliFFgziLhYYxEpNtIh_W-794Po7iuYIL__Q" />

  

  <meta name="tags" content="dns">
  <meta name="tags" content="email">
  <meta name="tags" content="spf">
  <meta name="tags" content="python">
  <meta name="tags" content="authentication">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Verify SPF using PySPF module">
  <meta property="og:description" content="Short introduction to using pyspf to verify SPF records">
  <meta property="og:url" content="https://blog.xoxzo.com/en/2012/12/03/verify-spf-using-pyspf-module/">
  <meta property="og:site_name" content="Xoxzo Official Blog: Empowerment">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@xoxzotelephony">
  <meta name="twitter:title" content="Verify SPF using PySPF module">
  <meta name="twitter:description" content="Short introduction to using pyspf to verify SPF records">

    <title>Xoxzo Official Blog: Empowerment</title>
    <link rel="icon" href="https://blog.xoxzo.com/en/theme/images/xoxzo_16x16_favicon.png">

    <link rel="stylesheet" href="https://blog.xoxzo.com/en/theme/css/bootstrap.min.css">
    <link href="https://blog.xoxzo.com/en/theme/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://blog.xoxzo.com/en/theme/css/main.css">
    <link rel="stylesheet" href="https://blog.xoxzo.com/en/theme/css/pygment.css">

    <link href="https://blog.xoxzo.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment - Full RSS Feed">
    <link href="https://blog.xoxzo.com/feeds/all-en.rss.xml" type="application/rss+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment - English Article RSS Feed">
    <link href="https://blog.xoxzo.com/feeds/all-ja.rss.xml" type="application/rss+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment - Japanese Article RSS Feed">
    <link href="https://blog.xoxzo.com/feeds/engineering.rss.xml" type="application/rss+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment - Engineering Category RSS Feed">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="non-sticky-footer">
    <nav class="navbar navbar-fixed-top navbar-dark bg-inverse">
        <div class="container">
            <a class="navbar-brand" href="https://blog.xoxzo.com/en">
                <img src="https://blog.xoxzo.com/en/theme/images/xoxzo_navbar_logo_w_trans.png">
                <span>BLOG</span>
            </a>
            <button class="navbar-toggler hidden-md-up float-xs-right" type="button" data-toggle="collapse" data-target="#collapsingNav" aria-controls="collapsingNav" aria-expanded="false" aria-label="Toggle navigation"></button>
            <div class="collapse navbar-toggleable-sm" id="collapsingNav">
                <ul class="nav navbar-nav float-xs-left float-md-right">
                <!--
                    <li class="nav-item"><a class="nav-link "
                    href="https://blog.xoxzo.com/en/pages/we-are-xoxzo/">Who We Are</a></li>
                -->
                    <li class="nav-item">
                        <a class="nav-link" href="https://info.xoxzo.com/en/" target="_blank"><i class="fa fa-home" aria-hidden="true"></i> Who We Are</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://twitter.com/xoxzotelephony" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Twitter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://blog.xoxzo.com/feeds/all.rss.xml" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i> Blog Feed</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-globe" aria-hidden="true"></i>
                            Language&nbsp;
                            <span class="caret"></span>
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="/en/">English</a>
                            <a class="dropdown-item" href="/ja/">日本語</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    
<div class="with-sidebar">
    <main class="container">
        <div class="row">
            <section class="content col-md-8 col-lg-9 float-md-right">
                <div class="container">
                    <article>
                        <h2 class="article-info">
                            2012-12-03 /
                            <a href="https://blog.xoxzo.com/en/engineering/">Engineering</a>
                        </h2>
                        <h1 class="article-title">Verify SPF using PySPF module</h1>
                        <p class="article-author">By                            <a href="https://blog.xoxzo.com/en/author/kamal-mustafa.html">Kamal Mustafa</a>
                            <br>
                            
                        </p>
                        <hr>
                        <div class="article-content">
                          <p>We deal with email a lot and one thing with handling email is to verify
where it came from. We must make sure when we receive email from
someone@gmail.com, it really was sent from gmail.com server, not from someone
else's email server. <a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF or Sender Policy Framework</a> is
what being used for that. For all our apps, we used <code>libspf</code> which we
wrapped into a convenience python extension that can be used across projects.
As time goes by, we want to start depreciating all our C code and move
everything (hopefully) to Python.</p>
<p>There's a Python module called <code>pyspf</code>. It looks like what we're looking
for although the documentation seems to suggest that it part of bigger module
called <code>pymilter</code>. I can't find any documentation showing how to use only the
SPF checking utility (if it has one) and after digging through the <a href="http://pymilter.cvs.sourceforge.net/viewvc/pymilter/pyspf/spf.py?view=markup">source
code</a>,
I found out the function that we need. It exists as <code>spf.check2()</code> function.</p>
<p>In order to use <code>pyspf</code> we also need it dependency which called <code>pydns</code>.
The following command should cover us well:-</p>
<div class="highlight"><pre><span></span>easy_install pyspf
easy_install pydns
</pre></div>


<p>The module then available for import under the name <code>spf</code>. You can
import it like below:-</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spf</span>
</pre></div>


<p>The function signature for <code>spf.check2</code> function look like this:-</p>
<div class="highlight"><pre><span></span>def check2(i, s, h, local=None, receiver=None):
</pre></div>


<p>where <code>i</code> for ip address, <code>s</code> for the sender email address, and <code>h</code> for
the email address domain part. So we can do our check for example as:-</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; spf.check2(&#39;180.73.166.174&#39;, &#39;someone@gmail.com&#39;, &#39;gmail.com&#39;)
(&#39;neutral&#39;, &#39;access neither permitted nor denied&#39;)
</pre></div>


<p>The return value would be in form <code>result, explanation</code> which is a
tuple. <code>result</code> can either be 'pass', 'fail', 'permerror', 'temperror',
'softfail', 'none' or 'neutral'. We run side by side test with our
existing spf function and the result seem to match so we're quite confident
this function is what we're looking for. Now it less one C code that we have to maintain.</p>
                        </div>
                        <div class="article-tag">
                            <a href="https://blog.xoxzo.com/en/tag/dns/">
                                <span class="btn btn-tag btn-sm">dns</span>
                            </a>
                            <a href="https://blog.xoxzo.com/en/tag/email/">
                                <span class="btn btn-tag btn-sm">email</span>
                            </a>
                            <a href="https://blog.xoxzo.com/en/tag/spf/">
                                <span class="btn btn-tag btn-sm">spf</span>
                            </a>
                            <a href="https://blog.xoxzo.com/en/tag/python/">
                                <span class="btn btn-tag btn-sm">python</span>
                            </a>
                            <a href="https://blog.xoxzo.com/en/tag/authentication/">
                                <span class="btn btn-tag btn-sm">authentication</span>
                            </a>
                        </div>
                    </article>
                </div>
            </section>

<section class="sidebar col-md-4 col-lg-3">
    <div class="container">
        <div class="sidebar-menu">
            <h3>CATEGORIES</h3>
            <ul>
                <li><a href="https://blog.xoxzo.com/en/announcements/">Announcements</a></li>
                <li><a href="https://blog.xoxzo.com/en/community/">Community</a></li>
                <li><a href="https://blog.xoxzo.com/en/engineering/">Engineering</a></li>
                <li><a href="https://blog.xoxzo.com/en/events/">Events</a></li>
                <li><a href="https://blog.xoxzo.com/en/fullcourt/">FullCourt</a></li>
                <li><a href="https://blog.xoxzo.com/en/pr/">PR</a></li>
                <li><a href="https://blog.xoxzo.com/en/the-way-we-work/">The Way We Work</a></li>
            </ul>
        </div>
        <div class="sidebar-menu">
            <h3>TAGS</h3>
            <ul>
                <li><a href="https://blog.xoxzo.com/en/tag/10-years/">10 years</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/2016/">2016</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/2017/">2017</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/24-hours/">24 hours</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/audio/">audio</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/authentication/">authentication</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/aws/">aws</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/browsers/">browsers</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/class-based-views/">class based views</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/community/">community</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/connexionnexus/">connexion@nexus</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/costs/">costs</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/credits/">credits</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/developer/">developer</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/dial-in-numbers/">dial in numbers</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/din/">din</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/distribute/">distribute</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/django/">django</a> (7)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/django-views/">django views</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/djangogirls/">djangogirls</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/dns/">dns</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/dong-jing/">東京</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/downtime/">downtime</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/easy_install/">easy_install</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/email/">email</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/endofservice/">endofservice</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/eol/">eol</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/eoy-notice/">EOY-notice</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/event/">event</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/exhibition/">exhibition</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/fullcourt/">fullcourt</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/generic-views/">generic views</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/git/">git</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/github/">github</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/goodbye/">goodbye</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/happy-birthday/">happy birthday</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/hatten-hotel/">hatten hotel</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/html5/">html5</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/ivr/">ivr</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/jomlaunch/">jomlaunch</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/kof/">kof</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/kuala-lumpur/">kuala lumpur</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/kumamoto/">kumamoto</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/ma/">m&a</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/malacca/">malacca</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/malaysia/">malaysia</a> (3)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/marimore/">marimore</a> (3)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/maritex/">maritex</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/my/">my</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/new-release/">new release</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/nomad/">nomad</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/open-source/">open source</a> (3)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/osaka/">osaka</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/osc/">osc</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/oss/">oss</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/php/">php</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pip/">pip</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pr/">pr</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/price/">price</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/price-review/">Price Review</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pycon/">pycon</a> (4)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pycon-au/">pycon au</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pycon-au-2015/">pycon au 2015</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pyconmy/">pyconmy</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/pypi/">pypi</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/python/">python</a> (15)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/remote/">remote</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/ruby/">ruby</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/scm/">scm</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/seminar/">seminar</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/setuptools/">setuptools</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/spf/">spf</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/sponsor/">sponsor</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/subversion/">subversion</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/svn/">svn</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/talk/">talk</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/team-camp/">team camp</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/tech/">tech</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/telephony/">telephony</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/text-to-speech/">text-to-speech</a> (2)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/tips/">tips</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/tokyo/">tokyo</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/transaction/">transaction</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/tts/">TTS</a> (3)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/vacancy/">vacancy</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/version-control/">version control</a> (3)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/voice-and-sms-api/">voice and sms api</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/workshop/">workshop</a> (1)</li>
                <li><a href="https://blog.xoxzo.com/en/tag/xoxzo/">xoxzo</a> (4)</li>
            </ul>
        </div>
    </div>
</section>
        </div>
    </main>
</div>

    <footer>
        <div class="container text-center">
            <p>© 2017 Xoxzo Inc. All rights reserved.</p>
            <p>Powered by <a href="http://getpelican.com/">Pelican</a></p>
        </div>
    </footer>
    <script src="https://blog.xoxzo.com/en/theme/js/jquery.min.js"></script>
    <script src="https://blog.xoxzo.com/en/theme/js/tether.min.js"></script>
    <script src="https://blog.xoxzo.com/en/theme/js/bootstrap.min.js"></script>
    <script src="https://blog.xoxzo.com/en/theme/js/jquery.matchHeight.js"></script>

    <script type="text/javascript">
        $(function() {
            $('.with-sidebar section').matchHeight();
        });
    </script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
            Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-67735042-7', 'auto');
        ga('send', 'pageview');
    </script>


</body>
</html>