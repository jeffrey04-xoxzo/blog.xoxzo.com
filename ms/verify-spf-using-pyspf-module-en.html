<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <meta name="tags" content="dns">
  <meta name="tags" content="email">
  <meta name="tags" content="spf">
  <meta property="og:type" content="article">
  <meta property="og:title" content="Verify SPF using PySPF module">
  <meta property="og:description" content="">
  <meta property="og:url" content="http://blog.xoxzo.com/ms/verify-spf-using-pyspf-module-en.html">
  <meta property="og:site_name" content="">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@xoxzotelephony">
  <meta name="twitter:title" content="Verify SPF using PySPF module">
  <meta name="twitter:description" content="">

    <title></title>
    <link rel="icon" href="http://blog.xoxzo.com/ms/theme/images/xoxzo_16x16_favicon.png">

    <link rel="stylesheet" href="http://blog.xoxzo.com/ms/theme/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://blog.xoxzo.com/ms/theme/css/main.css">
    <link rel="stylesheet" href="http://blog.xoxzo.com/ms/theme/css/pygment.css">

    <link href="http://blog.xoxzo.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title=" Full Atom Feed" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="non-sticky-footer">
    <nav class="navbar navbar-fixed-top navbar-dark bg-inverse">
        <div class="container">
            <a class="navbar-brand" href="http://blog.xoxzo.com/ms">
                <img src="http://blog.xoxzo.com/ms/theme/images/xoxzo_navbar_logo_w_trans.png">
                <span>BLOG</span>
            </a>
            <button class="navbar-toggler hidden-sm-up float-xs-right" type="button" data-toggle="collapse" data-target="#collapsingNav" aria-controls="collapsingNav" aria-expanded="false" aria-label="Toggle navigation"></button>
            <div class="collapse navbar-toggleable-xs" id="collapsingNav">
                <ul class="nav navbar-nav float-xs-left float-sm-right">
                <!--
                    <li class="nav-item"><a class="nav-link "
                    href="http://blog.xoxzo.com/ms/pages/we-are-xoxzo/">Who We Are</a></li>
                -->
                    <li class="nav-item">
                    <a class="nav-link" href="https://info.xoxzo.com/en/">Who We Are</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://twitter.com/xoxzotelephony">Twitter</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


<div class="with-sidebar">
    <main class="container">
        <div class="row">
            <section class="content col-md-8 col-lg-9 float-md-right">
                <div class="container">
                    <article>
                        <h2 class="article-info">
                            2012-12-03 /
                            <a href="http://blog.xoxzo.com/ms/category/engineering-python.html">Engineering, Python</a>
                        </h2>
                        <h1 class="article-title">Verify SPF using PySPF module</h1>
                        <p class="article-author">By
                            <a href="http://blog.xoxzo.com/ms/author/kamal-mustafa.html">Kamal Mustafa</a>
                            <br>
                            
                        </p>
                        <hr>
                        <div class="article-content">
                          <p>We deals with email a lot and one thing with handling email is to verify
where it come from. We must make sure when we receive email from
someone@gmail.com, it really was sent from gmail.com server, not from someone
else email server. <a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF or Sender Policy Framework</a> is
what being used for that. For all our apps, we used <code>libspf</code> which we
wrapped into a convenience python extension that can be used across projects.
As time goes by, we want to start depreciating all our C code and move
everything (hopefully) to Python.</p>
<p>There's a Python module called <code>pyspf</code>. It look like what we're looking
for although the documentation seem to suggest that it part of bigger module
called <code>pymilter</code>. I can't find any documentation showing how to use only the
SPF checking utility (if it has one) and after digging through the <a href="http://pymilter.cvs.sourceforge.net/viewvc/pymilter/pyspf/spf.py?view=markup">source
code</a>,
I found out the function that we need. It exists as <code>spf.check2()</code> function.</p>
<p>In order to use <code>pyspf</code> we also need it dependency which called <code>pydns</code>.
The following command should cover us well:-</p>
<div class="highlight"><pre><span></span>easy_install pyspf
easy_install pydns
</pre></div>


<p>The module then available for import under the name <code>spf</code>. You can
import it like below:-</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spf</span>
</pre></div>


<p>The function signature for <code>spf.check2</code> function look like this:-</p>
<div class="highlight"><pre><span></span>def check2(i, s, h, local=None, receiver=None):
</pre></div>


<p>where <code>i</code> for ip address, <code>s</code> for the sender email address, and <code>h</code> for
the email address domain part. So we can do our check for example as:-</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; spf.check2(&#39;180.73.166.174&#39;, &#39;someone@gmail.com&#39;, &#39;gmail.com&#39;)
(&#39;neutral&#39;, &#39;access neither permitted nor denied&#39;)
</pre></div>


<p>The return value would be in form <code>result, explanation</code> which is a
tuple. <code>result</code> can either be 'pass', 'fail', 'permerror', 'temperror',
'softfail', 'none' or 'neutral'. We run side by side test with our
existing spf function and the result seem to match so we're quite confident
this function is what we're looking for. Now it less one C code that we have to maintain.</p>
                        </div>
                        <div class="article-tag">
                            <a href="http://blog.xoxzo.com/ms/tag/dns.html">
                                <span class="btn btn-tag btn-sm">dns</span>
                            </a>
                            <a href="http://blog.xoxzo.com/ms/tag/email.html">
                                <span class="btn btn-tag btn-sm">email</span>
                            </a>
                            <a href="http://blog.xoxzo.com/ms/tag/spf.html">
                                <span class="btn btn-tag btn-sm">spf</span>
                            </a>
                        </div>
                    </article>
                </div>
            </section>

<section class="sidebar col-md-4 col-lg-3">
    <div class="container">
        <div class="sidebar-menu">
            <h3>CATEGORIES</h3>
            <ul>
                <li><a href="http://blog.xoxzo.com/ms/category/announcements.html">Announcements</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/engineering.html">Engineering</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/engineering-python.html">Engineering, Python</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/events.html">Events</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/fullcourt.html">FullCourt</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/new-release-xoxzo.html">New Release, Xoxzo</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/pr.html">PR</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/the-way-we-work.html">The Way We Work</a></li>
                <li><a href="http://blog.xoxzo.com/ms/category/use-cases.html">Use Cases</a></li>
            </ul>
        </div>
        <div class="sidebar-menu">
            <h3>TAGS</h3>
            <ul>
                <li><a href="http://blog.xoxzo.com/ms/tag/adit.html">adit</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/api.html">API</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/apuri.html">アプリ</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/audio.html">audio</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/aws.html">aws</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ben-ren-que-ren.html">本人確認</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ben-ren-ren-zheng.html">本人認証</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/browsers.html">browsers</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/careermart.html">careermart</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/class-based-views.html">class based views</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/connexionnexus.html">connexion@nexus</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/costs.html">costs</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/daiyarusms.html">ダイヤルSMS</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/dao-da-lu.html">到達率</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/developer.html">developer</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/dial-in-numbers.html">dial in numbers</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/distribute.html">distribute</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/django.html">django</a> (7)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/django-views.html">django views</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/djangogirls.html">djangogirls</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/dns.html">dns</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/dong-jing.html">東京</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/easy_install.html">easy_install</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ecsaito.html">ECサイト</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/email.html">email</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/eoy-notice.html">EOY-notice</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/event.html">event</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ex.html">ex</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/exhibition.html">exhibition</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ezsms.html">ezsms</a> (18)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/freemltoku.html">freemlトーク</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/fullcourt.html">fullcourt</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/gao-ling-yuza.html">高齢ユーザ</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ge-ren-qing-bao.html">個人情報</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/generic-views.html">generic views</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/git.html">git</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/github.html">github</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/gmomedeiazhu-shi-hui-she.html">gmoメディア株式会社</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/hatten-hotel.html">hatten hotel</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/he-jie.html">和解</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/html5.html">html5</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/hun-nabi.html">婚ナビ</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/huridaiyaru.html">フリーダイヤル</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ivr.html">ivr</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/jian-she-zhu-shi-hui-she.html">⼾⽥建設株式会社</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/jomlaunch.html">jomlaunch</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/kof.html">kof</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/kuala-lumpur.html">kuala lumpur</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/liao-jin-gai-ding.html">料金改定</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ma.html">m&a</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/malacca.html">malacca</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/malaysia.html">malaysia</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/marimore.html">marimore</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/medeianetsutowakusabisu.html">メディアネットワークサービス</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/meruadoresu.html">メールアドレス</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/my.html">my</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/nomad.html">nomad</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/open-source.html">open source</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/osaka.html">osaka</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/oss.html">oss</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ota.html">OTA</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/php.html">php</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pip.html">pip</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pmaku.html">pマーク</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pr.html">pr</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/puraibashimaku.html">プライバシーマーク</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/puresuririsu.html">プレスリリース</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pycon.html">pycon</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pycon-au.html">pycon au</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pycon-au-2015.html">pycon au 2015</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/pypi.html">pypi</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/python.html">python</a> (12)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/qoo10.html">qoo10</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/remote.html">remote</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ren-ding.html">認定</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ren-zheng.html">認証</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ren-zheng-cheng-ren.html">認証・承認</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/ruby.html">ruby</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/sabisuzhong-liao.html">サービス終了</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/scm.html">scm</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/seminar.html">seminar</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/setuptools.html">setuptools</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/shi-li.html">実例</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/shiyotomeru.html">ショートメール</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/shiyotometsusezi.html">ショートメッセージ</a> (7)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/sms.html">sms</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/smsnoapipei-xin.html">smsのapi配信</a> (14)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/spf.html">spf</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/su-song.html">訴訟</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/subversion.html">subversion</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/svn.html">svn</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/talk.html">talk</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/te-xu.html">特許</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/team-camp.html">team camp</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/tech.html">tech</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/telephony.html">telephony</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/tips.html">tips</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/tokyo.html">tokyo</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/tong-zhi-bu-zhu-shou-duan.html">通知補助手段</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/transaction.html">transaction</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/use-cases.html">use cases</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/vacancy.html">vacancy</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/version-control.html">version control</a> (3)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/voice-and-sms-api.html">voice and sms api</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/vuinasuburodokiyasuto.html">ヴィーナスブロードキャスト</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/wing-sms.html">wing-sms</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/workshop.html">workshop</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/xi-dai-dian-hua.html">携帯電話</a> (2)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/xoxzo.html">xoxzo</a> (5)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/you-xian-hui-she-emuaishi.html">有限会社エムアイシー</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/you-xian-hui-she-medeikomu.html">有限会社メディコム</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/yuzaren-zheng.html">ユーザ認証</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zenlokzhu-shi-hui-she.html">zenlok株式会社</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zhu-shi-hui-she-aobatang.html">株式会社あおば堂</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zhu-shi-hui-she-huruiya.html">株式会社フルイヤー</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zhu-shi-hui-she-kiyurazu.html">株式会社キュラーズ</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zhu-shi-hui-she-orenzisupiritsutsu.html">株式会社オレンジスピリッツ</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zhu-shi-hui-she-pedaru.html">株式会社ペダル</a> (1)</li>
                <li><a href="http://blog.xoxzo.com/ms/tag/zhu-shi-hui-she-supauebu.html">株式会社スーパーウェブ</a> (1)</li>
            </ul>
        </div>
    </div>
</section>
        </div>
    </main>
</div>

    <footer>
        <div class="container text-center">
            <p>© 2016 Xoxzo Inc. All rights reserved.</p>
            <p>Powered by <a href="http://getpelican.com/">Pelican</a></p>
        </div>
    </footer>
    <script src="http://blog.xoxzo.com/ms/theme/js/jquery.min.js"></script>
    <script src="http://blog.xoxzo.com/ms/theme/js/tether.min.js"></script>
    <script src="http://blog.xoxzo.com/ms/theme/js/bootstrap.min.js"></script>
    <script src="http://blog.xoxzo.com/ms/theme/js/jquery.matchHeight.js"></script>

    <script type="text/javascript">
        $(function() {
            $('.with-sidebar section').matchHeight();
        });
    </script>
</body>
</html>