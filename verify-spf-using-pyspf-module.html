<!DOCTYPE html>
<html lang="en">
<head>
          <title>Xoxzo Official Blog: Empowerment</title>
        <meta charset="utf-8" />
        <link href="http://devblog.xoxzo.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment Full Atom Feed" />
        <link href="http://devblog.xoxzo.com/feeds/engineering-python.atom.xml" type="application/atom+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment Categories Atom Feed" />



    <meta name="tags" content="dns" />
    <meta name="tags" content="email" />
    <meta name="tags" content="spf" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">Xoxzo Official Blog: Empowerment <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./verify-spf-using-pyspf-module.html" rel="bookmark"
         title="Permalink to Verify SPF using PySPF module">Verify SPF using PySPF module</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2012-12-03T06:34:00+09:00">
      2012-12-03
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/kamal-mustafa.html">Kamal Mustafa</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>We deals with email a lot and one thing with handling email is to verify
where<br />
it come from. We must make sure when we receive email from
someone@gmail.com,<br />
it really was sent from gmail.com server, not from someone else email
server. <a href="https://en.wikipedia.org/wiki/Sender_Policy_Framework">SPF or Sender Policy
Framework</a> is
what being used for that. For all our<br />
apps, we used <code>libspf</code> which we wrapped into a convenience python
extension<br />
that can be used across projects. As time goes by, we want to start<br />
depreciating all our C code and move everything (hopefully) to Python.</p>
<p>There's a Python module called <code>pyspf</code>. It look like what we're looking
for<br />
although the documentation seem to suggest that it part of bigger module
called<br />
<code>pymilter</code>. I can't find any documentation showing how to use only the
SPF<br />
checking utility (if it has one) and after digging through the <a href="http://pymilter.cvs.sourceforge.net/viewvc/pymilter/pyspf/spf.py?view=markup">source
code</a>,
I<br />
found out the function that we need. It exists as <code>spf.check2()</code>
function.</p>
<p>In order to use <code>pyspf</code> we also need it dependency which called <code>pydns</code>.
The<br />
following command should cover us well:-</p>
<div class="highlight"><pre><span></span>easy_install pyspf
easy_install pydns
</pre></div>


<p>The module then available for import under the name <code>spf</code>. You can
import it<br />
like below:-</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spf</span>
</pre></div>


<p>The function signature for <code>spf.check2</code> function look like this:-</p>
<div class="highlight"><pre><span></span>def check2(i, s, h, local=None, receiver=None):
</pre></div>


<p>where <code>i</code> for ip address, <code>s</code> for the sender email address, and <code>h</code> for
the<br />
email address domain part. So we can do our check for example as:-</p>
<div class="highlight"><pre><span></span>&gt;&gt;&gt; spf.check2(&#39;180.73.166.174&#39;, &#39;someone@gmail.com&#39;, &#39;gmail.com&#39;)
(&#39;neutral&#39;, &#39;access neither permitted nor denied&#39;)
</pre></div>


<p>The return value would be in form <code>result, explanation</code> which is a
tuple. <code>result</code> can either be 'pass', 'fail', 'permerror', 'temperror',
'softfail', 'none' or 'neutral'. We run side by side test with our
existing spf function<br />
and the result seem to match so we're quite confident this function is
what<br />
we're looking for. Now it less one C code that we have to maintain.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>