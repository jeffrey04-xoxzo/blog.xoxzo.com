<!DOCTYPE html>
<html lang="en">
<head>
          <title>Xoxzo Official Blog: Empowerment</title>
        <meta charset="utf-8" />
        <link href="http://devblog.xoxzo.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment Full Atom Feed" />
        <link href="http://devblog.xoxzo.com/feeds/engineering.atom.xml" type="application/atom+xml" rel="alternate" title="Xoxzo Official Blog: Empowerment Categories Atom Feed" />



    <meta name="tags" content="class based views" />
    <meta name="tags" content="django" />
    <meta name="tags" content="django views" />
    <meta name="tags" content="generic views" />
    <meta name="tags" content="Python" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="./">Xoxzo Official Blog: Empowerment <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./porting-function-based-generic-views-to-class-based-views.html" rel="bookmark"
         title="Permalink to Porting function based generic views to class based views">Porting function based generic views to class based views</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2011-09-16T12:12:00+09:00">
      2011-09-16
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/kamal-mustafa.html">Kamal Mustafa</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>It not really obvious in the
<a href="https://docs.djangoproject.com/en/1.3/ref/class-based-views/">documentation</a>
how we should proceed. I try to make as little changes as possible to
code. The following is a sample function that we need to port to class
based views.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">list_detail</span>
<span class="k">def</span> <span class="nf">supported_sending_networks</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="kn">from</span> <span class="nn">django.core.paginator</span> <span class="kn">import</span> <span class="n">Paginator</span><span class="p">,</span> <span class="n">InvalidPage</span><span class="p">,</span> <span class="n">EmptyPage</span>
<span class="n">_TEMPLATE_PATH</span> <span class="o">=</span> <span class="s2">&quot;faq/list_sending_networks.html&quot;</span>
<span class="n">network_list</span> <span class="o">=</span> <span class="n">EZSPossibleSendNetwork</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">paginator</span> <span class="o">=</span> <span class="n">Paginator</span><span class="p">(</span><span class="n">network_list</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="k">return</span> <span class="n">list_detail</span><span class="o">.</span><span class="n">object_list</span><span class="p">(</span>
<span class="n">request</span><span class="p">,</span>
<span class="n">queryset</span><span class="o">=</span><span class="n">network_list</span><span class="p">,</span>
<span class="n">paginate_by</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
<span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">,</span>
<span class="n">template_name</span><span class="o">=</span><span class="n">_TEMPLATE_PATH</span><span class="p">,</span>
<span class="n">template_object_name</span><span class="o">=</span><span class="s1">&#39;networks&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>


<p>The new equivalent class based views for this is
<code>django.views.generic.list.ListView</code>. My first attempt after looking at
the documentation:-</p>
<div class="highlight"><pre><span></span>def def supported_sending_networks(request, page=1):
class SupportedSendingNetworkView(ListView):
queryset = EZSPossibleSendNetwork.objects.all()
paginate_by = 15
context_object_name = &#39;networks_list&#39;
template_name = &quot;faq/list_sending_networks.html&quot;
return SupportedSendingNetworkView.as_view()
</pre></div>


<p>but I got error related to something 'function object not iterable ...'.
Look like the as_view() function call actually return a function object
rather than a response. Looking around I'm supposed to alias the class
with the function name.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">SupportedSendingNetworkView</span>(<span class="n">ListView</span>):
<span class="n">queryset</span> = <span class="n">EZSPossibleSendNetwork</span>.<span class="n">objects</span>.<span class="nb">all</span>()
<span class="n">paginate_by</span> = <span class="mi">15</span>
<span class="n">context_object_name</span> = <span class="s">&#39;networks_list&#39;</span>
<span class="n">template_name</span> = <span class="s">&quot;faq/list_sending_networks.html&quot;</span>
<span class="n">supported_sending_networks</span> = <span class="n">SupportedSendingNetworkView</span>.<span class="n">as_view</span>()
</pre></div>


<p>Make sense since now <code>supported_sending_networks</code> would simply be a
plain function. While the views now work, there's still no pager. Turn
out that now Django only expect the <code>page</code> parameter for the pager to
work in either two ways only:-</p>
<ul>
<li>Specified as parameter in the urlconf.</li>
<li>As query string parameter.</li>
</ul>
<p>This mean I have to modify my urls.py definition. Once that defined, I
need to pass the page value as a context object by overriding the
get_context_data() method.</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="n">SupportedSendingNetworkView</span>(<span class="n">ListView</span>):
<span class="n">queryset</span> = <span class="n">EZSPossibleSendNetwork</span>.<span class="n">objects</span>.<span class="nb">all</span>()
<span class="n">paginate_by</span> = <span class="mi">15</span>
<span class="n">context_object_name</span> = <span class="s">&#39;networks_list&#39;</span>
<span class="n">template_name</span> = <span class="s">&quot;faq/list_sending_networks.html&quot;</span>
<span class="n">def</span> <span class="n">get_context_data</span>(<span class="k">self</span>, **<span class="n">kwargs</span>):
<span class="nb">context</span> = <span class="n">super</span>(<span class="n">SupportedSendingNetworkView</span>, <span class="k">self</span>).<span class="n">get_context_data</span>(**<span class="n">kwargs</span>)
<span class="n">try:</span>
<span class="nb">context</span>[<span class="s">&#39;page&#39;</span>] = <span class="nb">int</span>(<span class="k">self</span>.<span class="n">args</span>[<span class="mi">0</span>])
<span class="n">except</span> (<span class="n">IndexError</span>, <span class="n">ValueError</span>):
<span class="nb">context</span>[<span class="s">&#39;page&#39;</span>] = <span class="mi">1</span>
<span class="k">return</span> <span class="nb">context</span>
</pre></div>


<p>All parameters to the views now available as <code>self.args</code> or
<code>self.kwargs</code> respectively. Some other notes, function based generic
views would be <a href="https://docs.djangoproject.com/en/dev/internals/deprecation/">deprecated in
Django-1.5</a>
so if you moving to Django-1.3 this a good time to start porting your
generic views usage to class based views. It also not obvious to me that
we have to call the superclass method when overriding <code>get_context_data</code>
method otherwise you would not have the complete context data. It only
after I found this blog <a href="http://blog.oscarcp.com/?p=182">post</a>.</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>